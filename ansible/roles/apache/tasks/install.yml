---
- name: Apacheをインストール
  yum: name=httpd-2.2.15 state=latest

- name: DocumentRoot変更
  replace:
    dest=/etc/httpd/conf/httpd.conf
    regexp='^DocumentRoot "/var/www/html"'
    replace='DocumentRoot "{{ apache_document_root }}"'

- name: ServerSignatureコメントアウト（サーバー情報を隠匿）
  replace:
    dest=/etc/httpd/conf/httpd.conf
    regexp='^ServerSignature On'
    replace='# ServerSignature On'

- name: ファイル一覧表示しない
  replace:
    dest=/etc/httpd/conf/httpd.conf
    regexp='Options Indexes FollowSymLinks'
    replace='Options -Indexes FollowSymLinks'

- name: .htaccessを有効にする
  replace:
    dest=/etc/httpd/conf/httpd.conf
    regexp='AllowOverride None'
    replace='AllowOverride All'

- name: DocumentRoot作成
  command: mkdir -p {{ apache_document_root }}

- name: DocumentRootのアクセス権変更
  command: chmod 755 {{ apache_document_root }}

- name: DocumentRootの所有権変更
  command: chown -R apache.apache {{ apache_document_root }}